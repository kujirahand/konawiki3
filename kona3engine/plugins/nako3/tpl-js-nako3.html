<!-- [tpl-js-nako3.html] -->
<!-- 一度だけ取り込まれる部分 -->
<script type="text/javascript">
// baseurl
const baseurl = '{{ baseurl }}';

const nako3_clear = function (id, use_canvas) {
  const resultDiv = document.getElementById("nako3result_div_" + id)
  if (resultDiv) resultDiv.innerHTML = ''
  if (use_canvas) {
    var canvas = document.getElementById("nako3_canvas_" + id)
    if (canvas) {
      var ctx = canvas.getContext('2d')
      ctx.clearRect(0, 0, canvas.width, canvas.height)
    }
  }
  if (navigator.nako3) {
    navigator.nako3.clearPlugins()
  }
}

//------------------------------------
// なでしこのプログラムを実行する関数
//------------------------------------
function nako3_run(id, use_canvas) {
  if (typeof(navigator.nako3) === 'undefined' || ace_editors[id] === undefined) {
    alert('現在ライブラリを読み込み中です。しばらくお待ちください。')
    return
  }
  navigator.nako3.setFunc("表示ログクリア", [], function () { nako3_clear(id, false) })

  var canvas_name = "#nako3_canvas_" + id
  var div_name = "#nako3_div_" + id
  var addon =
    "「" + div_name + "」へDOM親要素設定;" +
    "「" + div_name + "」に「」をHTML設定;"
  if (use_canvas) {
    addon += 
      "「" + canvas_name + "」へ描画開始;" +
      "カメ描画先=「" + canvas_name + "」;" +
      "カメ全消去;"
  }
  const preCode = addon + "\n"

  const resultDiv = document.getElementById("nako3result_div_" + id)
  resultDiv.style.display = "block"
  ace_editors[id].run({ outputContainer: resultDiv, preCode })
}

</script>
<!-- [/tpl-js-nako3.html] -->
